<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Calendar 2025</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Framework -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        /* Hide number input spinners */
        .no-spinner::-webkit-inner-spin-button, 
        .no-spinner::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .no-spinner { -moz-appearance: textfield; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const IconUser = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-500"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const IconBriefcase = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-orange-500"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>;
        const IconDollar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-purple-500"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const IconLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>;
        const IconRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>;
        const IconReset = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;

        // --- CONFIGURATION ---
        const CONFIG = {
            RENT: 19500,
            GOAL_MULTIPLIER: 3,
            RATES: {
                SAMI: 1200,      // TL/hr
                DILKO: 350,      // TL/session
                YTB: 4500        // Fixed Monthly
            }
        };

        const GOAL_TOTAL = CONFIG.RENT * CONFIG.GOAL_MULTIPLIER;

        // --- HELPER: FINANCIAL MONTH GENERATOR ---
        // Rules: 
        // 1. Range: 20th of 'viewMonth' -> 19th of next month
        // 2. Dilko: Saturday=20, Sunday=16, others=0
        // 3. Sami: Mon, Tue, Wed = 1, others=0
        
        const generateFinancialMonth = (year, monthIndex) => {
            const days = [];
            
            // Start Date: 20th of the selected month
            let currentDate = new Date(year, monthIndex, 20);
            
            // We loop until we hit the 20th of the NEXT month (exclusive)
            // Safety break: 40 days max
            for (let i = 0; i < 40; i++) {
                // Stop condition: If we've reached the 20th of any subsequent month
                if (currentDate.getDate() === 20 && i > 0) break;

                const dayOfWeek = currentDate.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat
                
                // --- DEFAULT VALUES LOGIC ---
                let sami = 0;
                let dilko = 0;

                // SAMI: Mon(1), Tue(2), Wed(3)
                if (dayOfWeek === 1 || dayOfWeek === 2 || dayOfWeek === 3) {
                    sami = 1;
                }

                // DILKO: Sat(6)=20, Sun(0)=16
                if (dayOfWeek === 6) {
                    dilko = 20;
                } else if (dayOfWeek === 0) {
                    dilko = 16;
                }

                days.push({
                    id: currentDate.toISOString().split('T')[0], // YYYY-MM-DD
                    dateObj: new Date(currentDate),
                    dayOfWeek: dayOfWeek,
                    dayNum: currentDate.getDate(),
                    monthName: currentDate.toLocaleString('default', { month: 'short' }),
                    sami,
                    dilko,
                    natakallam: 0
                });

                // Move to next day
                currentDate.setDate(currentDate.getDate() + 1);
            }
            return days;
        };

        const App = () => {
            // --- STATE ---
            // Determine current financial month based on today's date
            // If today is before the 20th (e.g., Nov 5), we are in the "Oct-Nov" period.
            const today = new Date();
            const initialYear = today.getFullYear();
            const initialMonth = today.getDate() < 20 ? today.getMonth() - 1 : today.getMonth();

            const [viewYear, setViewYear] = useState(initialYear);
            const [viewMonth, setViewMonth] = useState(initialMonth);
            const [exchangeRate, setExchangeRate] = useState(37.5);
            
            // Storage Key: e.g., "fin_2025_10" (For Oct 20 - Nov 19)
            const storageKey = `fin_data_${viewYear}_${viewMonth}`;

            const [days, setDays] = useState([]);

            // Load or Init Data
            useEffect(() => {
                const saved = localStorage.getItem(storageKey);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        // Convert string dates back to Date objects
                        const rehydrated = parsed.map(d => ({...d, dateObj: new Date(d.id)}));
                        setDays(rehydrated);
                    } catch(e) {
                        setDays(generateFinancialMonth(viewYear, viewMonth));
                    }
                } else {
                    setDays(generateFinancialMonth(viewYear, viewMonth));
                }
            }, [viewYear, viewMonth]);

            // Save Data
            useEffect(() => {
                if (days.length > 0) {
                    localStorage.setItem(storageKey, JSON.stringify(days));
                }
            }, [days, storageKey]);

            // --- CALCULATIONS ---
            const natakallamRate = 12 * exchangeRate; 

            const totals = useMemo(() => days.reduce((acc, day) => {
                acc.sami += day.sami;
                acc.dilko += day.dilko;
                acc.natakallam += day.natakallam;
                return acc;
            }, { sami: 0, dilko: 0, natakallam: 0 }), [days]);

            const currentIncome = 
                CONFIG.RATES.YTB + 
                (totals.sami * CONFIG.RATES.SAMI) + 
                (totals.dilko * CONFIG.RATES.DILKO) + 
                (totals.natakallam * natakallamRate);

            const gap = GOAL_TOTAL - currentIncome;
            const isGoalMet = gap <= 0;

            const neededSami = isGoalMet ? 0 : Math.ceil(gap / CONFIG.RATES.SAMI);
            const neededDilko = isGoalMet ? 0 : Math.ceil(gap / CONFIG.RATES.DILKO);
            const neededNatakallam = isGoalMet ? 0 : Math.ceil(gap / natakallamRate);

            // --- HANDLERS ---
            const updateDay = (id, field, val) => {
                const num = Math.max(0, parseInt(val) || 0);
                setDays(prev => prev.map(d => d.id === id ? { ...d, [field]: num } : d));
            };

            const changeMonth = (offset) => {
                let m = viewMonth + offset;
                let y = viewYear;
                if (m > 11) { m = 0; y++; }
                if (m < 0) { m = 11; y--; }
                setViewYear(y);
                setViewMonth(m);
            };

            const resetToDefaults = () => {
                if(confirm("Reset all numbers in this month to default schedule?")) {
                    setDays(generateFinancialMonth(viewYear, viewMonth));
                }
            };

            // --- UI HELPERS ---
            // Label logic: "Nov 20 - Dec 19"
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const nextMonthIdx = viewMonth === 11 ? 0 : viewMonth + 1;
            const periodLabel = `${months[viewMonth]} 20 - ${months[nextMonthIdx]} 19, ${viewYear + (viewMonth===11?1:0)}`;

            // Calendar Alignment
            const startDayOfWeek = days.length > 0 ? (days[0].dayOfWeek === 0 ? 6 : days[0].dayOfWeek - 1) : 0; 
            const blanks = Array(startDayOfWeek).fill(null);

            return (
                <div className="min-h-screen pb-20 bg-slate-50">
                    
                    {/* TOP DASHBOARD */}
                    <div className="bg-white border-b sticky top-0 z-30 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800">Financial Planner</h1>
                                    <div className="text-xs text-gray-500 mt-1">Goal: <span className="font-semibold text-gray-700">{GOAL_TOTAL.toLocaleString()} TL</span> (3x Rent)</div>
                                </div>
                                
                                <div className="flex items-center gap-4 text-sm">
                                    <div className="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-full border">
                                        <span className="text-gray-500 font-medium">1 USD =</span>
                                        <input 
                                            type="number" 
                                            value={exchangeRate} 
                                            onChange={e => setExchangeRate(e.target.value)} 
                                            className="w-12 bg-transparent font-bold text-gray-700 outline-none text-right"
                                        />
                                        <span className="text-gray-500">TL</span>
                                    </div>
                                    <button onClick={resetToDefaults} className="text-xs flex items-center gap-1 text-red-500 hover:text-red-700 font-medium px-3 py-1.5 border border-red-100 rounded-full hover:bg-red-50 transition">
                                        <IconReset /> Defaults
                                    </button>
                                </div>
                            </div>

                            {/* STATS GRID */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                                {/* MAIN STATUS */}
                                <div className={`p-4 rounded-xl border-l-4 shadow-sm flex flex-col justify-between transition-colors ${isGoalMet ? 'bg-emerald-50 border-emerald-500' : 'bg-white border-slate-300'}`}>
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-wide">Projected Income</div>
                                    <div>
                                        <div className={`text-2xl font-bold ${isGoalMet ? 'text-emerald-700' : 'text-slate-800'}`}>
                                            {currentIncome.toLocaleString()} <span className="text-sm font-normal text-slate-400">TL</span>
                                        </div>
                                        <div className="w-full bg-slate-200 h-1.5 mt-3 rounded-full overflow-hidden">
                                            <div className={`h-full transition-all duration-500 ${isGoalMet ? 'bg-emerald-500' : 'bg-blue-600'}`} style={{width: `${Math.min((currentIncome/GOAL_TOTAL)*100, 100)}%`}}></div>
                                        </div>
                                    </div>
                                </div>

                                {/* ACTION 1: SAMI */}
                                <div className={`p-3 rounded-xl border flex items-center justify-between ${isGoalMet ? 'bg-slate-50 opacity-60' : 'bg-white border-blue-200 shadow-sm'}`}>
                                    <div className="flex flex-col h-full justify-between">
                                        <span className="text-[10px] font-bold text-slate-400 uppercase">Gap w/ Sami</span>
                                        <span className="text-xl font-bold text-blue-600">{neededSami} <span className="text-xs font-normal text-slate-400">hrs</span></span>
                                    </div>
                                    <div className="p-2 bg-blue-50 rounded-lg"><IconUser/></div>
                                </div>

                                {/* ACTION 2: DILKO */}
                                <div className={`p-3 rounded-xl border flex items-center justify-between ${isGoalMet ? 'bg-slate-50 opacity-60' : 'bg-white border-orange-200 shadow-sm'}`}>
                                    <div className="flex flex-col h-full justify-between">
                                        <span className="text-[10px] font-bold text-slate-400 uppercase">OR Dilko</span>
                                        <span className="text-xl font-bold text-orange-600">{neededDilko} <span className="text-xs font-normal text-slate-400">sess</span></span>
                                    </div>
                                    <div className="p-2 bg-orange-50 rounded-lg"><IconBriefcase/></div>
                                </div>

                                {/* ACTION 3: NATAKALLAM */}
                                <div className={`p-3 rounded-xl border flex items-center justify-between ${isGoalMet ? 'bg-slate-50 opacity-60' : 'bg-white border-purple-200 shadow-sm'}`}>
                                    <div className="flex flex-col h-full justify-between">
                                        <span className="text-[10px] font-bold text-slate-400 uppercase">OR Natakallam</span>
                                        <span className="text-xl font-bold text-purple-600">{neededNatakallam} <span className="text-xs font-normal text-slate-400">sess</span></span>
                                    </div>
                                    <div className="p-2 bg-purple-50 rounded-lg"><IconDollar/></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* CALENDAR NAVIGATION */}
                    <div className="max-w-7xl mx-auto px-4 mt-8">
                        <div className="flex items-center justify-between bg-white p-4 rounded-2xl shadow-sm border mb-6">
                            <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-slate-100 rounded-full transition text-slate-600"><IconLeft/></button>
                            <h2 className="text-lg md:text-xl font-bold text-slate-700 tracking-tight">{periodLabel}</h2>
                            <button onClick={() => changeMonth(1)} className="p-2 hover:bg-slate-100 rounded-full transition text-slate-600"><IconRight/></button>
                        </div>

                        {/* CALENDAR GRID */}
                        <div className="bg-white rounded-2xl shadow-sm border overflow-hidden">
                            {/* Header Row */}
                            <div className="grid grid-cols-7 border-b border-slate-100 bg-slate-50/80">
                                {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(d => (
                                    <div key={d} className="py-3 text-center text-xs font-bold text-slate-400 uppercase tracking-wider">{d}</div>
                                ))}
                            </div>

                            {/* Days Grid */}
                            <div className="grid grid-cols-7 bg-slate-100 gap-px border-b border-slate-200">
                                {blanks.map((_, i) => <div key={`blank-${i}`} className="bg-slate-50/50 min-h-[120px]"></div>)}
                                
                                {days.map((day) => {
                                    const isWeekend = day.dayOfWeek === 0 || day.dayOfWeek === 6;
                                    const isToday = new Date().toDateString() === day.dateObj.toDateString();
                                    const hasIncome = (day.sami + day.dilko + day.natakallam) > 0;
                                    
                                    return (
                                        <div key={day.id} className={`bg-white min-h-[120px] p-2 flex flex-col group relative transition-colors ${isToday ? 'bg-blue-50/40' : 'hover:bg-slate-50'}`}>
                                            
                                            {/* Date Header */}
                                            <div className="flex justify-between items-center mb-2">
                                                <span className={`text-sm font-bold w-7 h-7 flex items-center justify-center rounded-full ${isToday ? 'bg-blue-600 text-white' : (isWeekend ? 'text-red-400' : 'text-slate-700')}`}>
                                                    {day.dayNum}
                                                </span>
                                                {day.dayNum === 1 && <span className="text-[10px] font-bold text-slate-400 uppercase">{day.monthName}</span>}
                                            </div>

                                            {/* Input Stack */}
                                            <div className="space-y-1.5 flex-1">
                                                {/* Sami Row */}
                                                <div className="flex items-center group/input">
                                                    <div className={`w-1 h-6 rounded-full mr-1.5 transition-colors ${day.sami > 0 ? 'bg-blue-500' : 'bg-slate-200 group-hover/input:bg-blue-300'}`}></div>
                                                    <input 
                                                        type="number" 
                                                        value={day.sami || ''}
                                                        onChange={(e) => updateDay(day.id, 'sami', e.target.value)}
                                                        placeholder="-"
                                                        className="w-full text-sm font-mono text-slate-700 placeholder-slate-200 outline-none bg-transparent border-b border-transparent focus:border-blue-300 focus:bg-blue-50/50 transition-all rounded-sm px-1"
                                                    />
                                                </div>

                                                {/* Dilko Row */}
                                                <div className="flex items-center group/input">
                                                    <div className={`w-1 h-6 rounded-full mr-1.5 transition-colors ${day.dilko > 0 ? 'bg-orange-500' : 'bg-slate-200 group-hover/input:bg-orange-300'}`}></div>
                                                    <input 
                                                        type="number" 
                                                        value={day.dilko || ''}
                                                        onChange={(e) => updateDay(day.id, 'dilko', e.target.value)}
                                                        placeholder="-"
                                                        className="w-full text-sm font-mono text-slate-700 placeholder-slate-200 outline-none bg-transparent border-b border-transparent focus:border-orange-300 focus:bg-orange-50/50 transition-all rounded-sm px-1"
                                                    />
                                                </div>

                                                {/* Natakallam Row */}
                                                <div className="flex items-center group/input">
                                                    <div className={`w-1 h-6 rounded-full mr-1.5 transition-colors ${day.natakallam > 0 ? 'bg-purple-500' : 'bg-slate-200 group-hover/input:bg-purple-300'}`}></div>
                                                    <input 
                                                        type="number" 
                                                        value={day.natakallam || ''}
                                                        onChange={(e) => updateDay(day.id, 'natakallam', e.target.value)}
                                                        placeholder="-"
                                                        className="w-full text-sm font-mono text-slate-700 placeholder-slate-200 outline-none bg-transparent border-b border-transparent focus:border-purple-300 focus:bg-purple-50/50 transition-all rounded-sm px-1"
                                                    />
                                                </div>
                                            </div>

                                            {/* Daily Total (Hover only) */}
                                            {hasIncome && (
                                                <div className="mt-2 text-[10px] text-right text-slate-400 font-mono opacity-0 group-hover:opacity-100 transition-opacity">
                                                    {( (day.sami*CONFIG.RATES.SAMI) + (day.dilko*CONFIG.RATES.DILKO) + (day.natakallam*natakallamRate) ).toLocaleString()}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Legend */}
                        <div className="flex justify-center gap-6 mt-6 pb-6 text-xs text-slate-500 font-medium">
                            <div className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-blue-500"></span> Sami (Hrs)
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-orange-500"></span> Dilko (Sessions)
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-purple-500"></span> Natakallam (Sessions)
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
